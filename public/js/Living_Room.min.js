b4w.register("Living_Room",function(O,e){function P(a,d){d?(C.create_preloader(),a.addEventListener("mousedown",D),a.addEventListener("touchstart",D),a.addEventListener("mouseup",E),a.addEventListener("touchend",E),a.addEventListener("mousemove",F),a.addEventListener("touchmove",F),window.onresize=y.resize_to_container,y.resize_to_container(),n.load(q+"environment.json",Q,R)):console.log("b4w init failure")}function R(a){C.update_preloader(a)}function Q(){r.enable_camera_controls(!1,!1,!1,y.get_canvas());
S();var a=k.get_object_by_name("spawner");g.get_translation(a,z)}function S(){var a=document.getElementById("spinner-container");document.getElementById("controls-container").style.display="block";T();document.getElementById("load-1").addEventListener("click",function(){a.style.display="block";n.load(q+"bed.json",u,null,null,!0)});document.getElementById("load-2").addEventListener("click",function(){a.style.display="block";n.load(q+"chair.json",u,null,null,!0)});document.getElementById("load-3").addEventListener("click",
function(){a.style.display="block";n.load(q+"commode_and_pot.json",u,null,null,!0)});document.getElementById("load-4").addEventListener("click",function(){a.style.display="block";n.load(q+"fan.json",u,null,null,!0)});document.getElementById("load-5").addEventListener("click",function(){for(var a=h.get_selectable_objects(),b="$",c=!1,f=0;f<a.length;f++){var e=a[f];1==m.get_sensor_value(e,"COLLISION",0)&&(c=!0);e=g.get_object_bounding_box(e);b=b+e.min_x.toFixed(3)+","+e.max_x.toFixed(3)+","+e.min_y.toFixed(3)+
","+e.max_y.toFixed(3)+","+e.min_z.toFixed(3)+","+e.max_z.toFixed(3)+"$"}0==c?prompt("Here is your result! Please copy (CTRL+C) and paste into survey.",b):window.alert("Please ensure there are no overlapping objects and try again.")});document.getElementById("delete").addEventListener("click",function(){if(f){var a=k.get_object_data_id(f);n.unload(a);f=null}});document.getElementById("rot-ccw").addEventListener("click",function(){f&&G(f,H)});document.getElementById("rot-cw").addEventListener("click",
function(){f&&G(f,-H)})}function T(){for(var a=["delete","rot-ccw","rot-cw"],d=0;d<a.length;d++){var b=a[d];document.getElementById(b).addEventListener("mousedown",function(a){a.target.parentNode.classList.add("active")});document.getElementById(b).addEventListener("mouseup",function(a){a.target.parentNode.classList.remove("active")});document.getElementById(b).addEventListener("touchstart",function(a){a.target.parentNode.classList.add("active")});document.getElementById(b).addEventListener("touchend",
function(a){a.target.parentNode.classList.remove("active")})}}function u(a){var d=document.getElementById("spinner-container");a=k.get_all_objects("ALL",a);for(var b=0;b<a.length;b++){var c=a[b];if(I.has_physics(c)){I.enable_simulation(c);var e=m.create_collision_sensor(c,"FURNITURE"),l=m.create_selection_sensor(c,!0);c==f&&m.set_custom_sensor(l,1);m.create_sensor_manifold(c,"COLLISION",m.CT_CONTINUOUS,[e,l],U,V);(e=h.get_parent(c))&&h.is_armature(e)?g.set_translation_v(e,z):g.set_translation_v(c,
z)}h.is_mesh(c)&&(k.show_object(c),d.style.display="none")}}function U(a){return a[1]}function V(a,d,b){1==b&&(m.get_sensor_value(a,d,0)?k.set_outline_color(W):k.set_outline_color(X))}function G(a,d){var b=h.get_parent(a);if(b&&h.is_armature(b)){var c=g.get_rotation(b,J);K.rotateZ(c,d,c);g.set_rotation_v(b,c)}else c=g.get_rotation(a,J),K.rotateZ(c,d,c),g.set_rotation_v(a,c);L(a)}function D(a){A=!0;a.preventDefault&&a.preventDefault();var d=v.get_coords_x(a);a=v.get_coords_y(a);var b=k.pick_object(d,
a);f!=b&&(f&&k.clear_outline_anim(f),b&&k.apply_outline_anim(b,1,1,0),f=b);if(f){var b=k.get_active_camera(),c=h.get_parent(f);c&&h.is_armature(c)?g.get_translation(c,p):g.get_translation(f,p);M.project_point(b,p,l);l[0]=d-l[0];l[1]=a-l[1]}}function E(){A=!1;w||(r.enable_camera_controls(),w=!0)}function F(a){if(A&&f){w&&(r.disable_camera_controls(),w=!1);var d=k.get_active_camera(),b=v.get_coords_x(a);a=v.get_coords_y(a);0<=b&&0<=a&&(b-=l[0],a-=l[1],b=M.calc_ray(d,b,a,x),b=t.get_pline_directional_vec(b,
p),d=g.get_translation(d,Y),t.set_pline_initial_point(x,d),t.set_pline_directional_vec(x,b),(d=t.line_plane_intersect(Z,0,x,aa))&&0>b[2]&&((b=h.get_parent(f))&&h.is_armature(b)?g.set_translation_v(b,d):g.set_translation_v(f,d),L(f)))}}function L(a){var d=g.get_object_bounding_box(a),b=h.get_parent(a),c=b&&h.is_armature(b)?g.get_translation(b,p):g.get_translation(a,p);3.35<d.max_x?c[0]-=d.max_x-3.35:0>d.min_x&&(c[0]+=0-d.min_x);3.048<d.max_y?c[1]-=d.max_y-3.048:0>d.min_y&&(c[1]+=0-d.min_y);b&&h.is_armature(b)?
g.set_translation_v(b,c):g.set_translation_v(a,c)}var r=e("app"),M=e("camera"),ba=e("config"),y=e("container"),m=e("controls"),n=e("data"),v=e("mouse"),t=e("math"),h=e("objects"),I=e("physics"),C=e("preloader"),k=e("scenes"),g=e("transform"),N=e("version"),N=e("version"),K=e("quat"),B="DEBUG"===N.type(),X=[0,1,0],W=[1,0,0],Z=[0,0,1],H=Math.PI/2,q=ba.get_std_assets_path("Living_Room"),l=new Float32Array(2),z=new Float32Array(3),p=new Float32Array(3),Y=new Float32Array(3),aa=new Float32Array(3),J=new Float32Array(4),
x=t.create_pline(),A=!1,w=!0,f=null;O.init=function(){var a=B,d=r.get_url_params();d&&"show_fps"in d&&(a=!0);r.init({canvas_container_id:"main_canvas_container",callback:P,physics_enabled:!0,show_fps:a,alpha:!1,assets_dds_available:!B,assets_min50_available:!B,background_color:[1,1,1,0]})}});b4w.require("Living_Room").init();
