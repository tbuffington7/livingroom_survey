b4w.register("Living_Room",function(N,f){function O(a,c){c?(C.create_preloader(),a.addEventListener("mousedown",D),a.addEventListener("touchstart",D),a.addEventListener("mouseup",E),a.addEventListener("touchend",E),a.addEventListener("mousemove",F),a.addEventListener("touchmove",F),window.onresize=x.resize_to_container,x.resize_to_container(),p.load(q+"environment.json",P,Q)):console.log("b4w init failure")}function Q(a){C.update_preloader(a)}function P(){r.enable_camera_controls(!1,!1,!1,x.get_canvas());
R();var a=k.get_object_by_name("spawner");g.get_translation(a,y)}function R(){document.getElementById("controls-container").style.display="block";S();document.getElementById("load-1").addEventListener("click",function(){p.load(q+"bed.json",z,null,null,!0)});document.getElementById("load-2").addEventListener("click",function(){p.load(q+"chair.json",z,null,null,!0)});document.getElementById("load-4").addEventListener("click",function(){p.load(q+"fan.json",z,null,null,!0)});document.getElementById("load-5").addEventListener("click",
function(){for(var a=h.get_selectable_objects(),c="$",b=!1,d=0;d<a.length;d++){var e=a[d];1==l.get_sensor_value(e,"COLLISION",0)&&(b=!0);e=g.get_object_bounding_box(e);c=c+e.min_x.toFixed(3)+","+e.max_x.toFixed(3)+","+e.min_y.toFixed(3)+","+e.max_y.toFixed(3)+","+e.min_z.toFixed(3)+","+e.max_z.toFixed(3)+"$"}0==b?prompt("Here is your result! Please copy (CTRL+C) and paste into survey.",c):window.alert("Please ensure there are no overlapping objects and try again.")});document.getElementById("delete").addEventListener("click",
function(){if(e){var a=k.get_object_data_id(e);p.unload(a);e=null}});document.getElementById("rot-ccw").addEventListener("click",function(){e&&G(e,H)});document.getElementById("rot-cw").addEventListener("click",function(){e&&G(e,-H)})}function S(){for(var a=["delete","rot-ccw","rot-cw"],c=0;c<a.length;c++){var b=a[c];document.getElementById(b).addEventListener("mousedown",function(a){a.target.parentNode.classList.add("active")});document.getElementById(b).addEventListener("mouseup",function(a){a.target.parentNode.classList.remove("active")});
document.getElementById(b).addEventListener("touchstart",function(a){a.target.parentNode.classList.add("active")});document.getElementById(b).addEventListener("touchend",function(a){a.target.parentNode.classList.remove("active")})}}function z(a){a=k.get_all_objects("ALL",a);for(var c=0;c<a.length;c++){var b=a[c];if(I.has_physics(b)){I.enable_simulation(b);var d=l.create_collision_sensor(b,"FURNITURE"),f=l.create_selection_sensor(b,!0);b==e&&l.set_custom_sensor(f,1);l.create_sensor_manifold(b,"COLLISION",
l.CT_CONTINUOUS,[d,f],T,U);(d=h.get_parent(b))&&h.is_armature(d)?g.set_translation_v(d,y):g.set_translation_v(b,y)}h.is_mesh(b)&&k.show_object(b)}}function T(a){return a[1]}function U(a,c,b){1==b&&(l.get_sensor_value(a,c,0)?k.set_outline_color(V):k.set_outline_color(W))}function G(a,c){var b=h.get_parent(a);if(b&&h.is_armature(b)){var d=g.get_rotation(b,J);K.rotateZ(d,c,d);g.set_rotation_v(b,d)}else d=g.get_rotation(a,J),K.rotateZ(d,c,d),g.set_rotation_v(a,d);L(a)}function D(a){A=!0;a.preventDefault&&
a.preventDefault();var c=u.get_coords_x(a);a=u.get_coords_y(a);var b=k.pick_object(c,a);e!=b&&(e&&k.clear_outline_anim(e),b&&k.apply_outline_anim(b,1,1,0),e=b);if(e){var b=k.get_active_camera(),d=h.get_parent(e);d&&h.is_armature(d)?g.get_translation(d,n):g.get_translation(e,n);M.project_point(b,n,m);m[0]=c-m[0];m[1]=a-m[1]}}function E(){A=!1;v||(r.enable_camera_controls(),v=!0)}function F(a){if(A&&e){v&&(r.disable_camera_controls(),v=!1);var c=k.get_active_camera(),b=u.get_coords_x(a);a=u.get_coords_y(a);
0<=b&&0<=a&&(b-=m[0],a-=m[1],b=M.calc_ray(c,b,a,w),b=t.get_pline_directional_vec(b,n),c=g.get_translation(c,X),t.set_pline_initial_point(w,c),t.set_pline_directional_vec(w,b),(c=t.line_plane_intersect(Y,0,w,Z))&&0>b[2]&&((b=h.get_parent(e))&&h.is_armature(b)?g.set_translation_v(b,c):g.set_translation_v(e,c),L(e)))}}function L(a){var c=g.get_object_bounding_box(a),b=h.get_parent(a),d=b&&h.is_armature(b)?g.get_translation(b,n):g.get_translation(a,n);3.35<c.max_x?d[0]-=c.max_x-3.35:0>c.min_x&&(d[0]+=
0-c.min_x);3.048<c.max_y?d[1]-=c.max_y-3.048:0>c.min_y&&(d[1]+=0-c.min_y);b&&h.is_armature(b)?g.set_translation_v(b,d):g.set_translation_v(a,d)}var r=f("app"),M=f("camera"),aa=f("config"),x=f("container"),l=f("controls"),p=f("data"),u=f("mouse"),t=f("math"),h=f("objects"),I=f("physics"),C=f("preloader"),k=f("scenes"),g=f("transform"),ba=f("version"),K=f("quat"),B="DEBUG"===ba.type(),W=[0,1,0],V=[1,0,0],Y=[0,0,1],H=Math.PI/2,q=aa.get_std_assets_path("Living_Room");var m=new Float32Array(2),
y=new Float32Array(3),n=new Float32Array(3),X=new Float32Array(3),Z=new Float32Array(3),J=new Float32Array(4),w=t.create_pline(),A=!1,v=!0,e=null;N.init=function(){var a=B,c=r.get_url_params();c&&"show_fps"in c&&(a=!0);r.init({canvas_container_id:"main_canvas_container",callback:O,physics_enabled:!0,show_fps:a,alpha:!1,assets_dds_available:!B,assets_min50_available:!B,background_color:[1,1,1,0]})}});b4w.require("Living_Room").init();
