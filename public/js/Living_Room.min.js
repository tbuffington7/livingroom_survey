b4w.register("Living_Room",function(Q,e){function R(a,d){d?(E.create_preloader(),a.addEventListener("mousedown",F),a.addEventListener("touchstart",F),a.addEventListener("mouseup",G),a.addEventListener("touchend",G),a.addEventListener("mousemove",H),a.addEventListener("touchmove",H),window.onresize=A.resize_to_container,A.resize_to_container(),l.load(m+"environment.json",S,T)):console.log("b4w init failure")}function T(a){E.update_preloader(a)}function S(){u.enable_camera_controls(!1,!1,!1,A.get_canvas());
U();var a=g.get_object_by_name("spawner");h.get_translation(a,B)}function U(){var a=document.getElementById("spinner-container");document.getElementById("controls-container").style.display="block";V();document.getElementById("load-1").addEventListener("click",function(){a.style.display="block";l.load(m+"couch.json",r,null,null,!0);n.push("C")});document.getElementById("load-2").addEventListener("click",function(){a.style.display="block";l.load(m+"love_seat.json",r,null,null,!0);n.push("L")});document.getElementById("load-3").addEventListener("click",
function(){a.style.display="block";l.load(m+"chair.json",r,null,null,!0);n.push("H")});document.getElementById("load-4").addEventListener("click",function(){a.style.display="block";l.load(m+"table.json",r,null,null,!0);n.push("T")});document.getElementById("load-5").addEventListener("click",function(){a.style.display="block";l.load(m+"tv_stand.json",r,null,null,!0);n.push("S")});document.getElementById("load-6").addEventListener("click",function(){a.style.display="block";l.load(m+"end_table.json",
r,null,null,!0);n.push("E")});document.getElementById("load-7").addEventListener("click",function(){var a=k.get_selectable_objects(),b="$",c=!1,f=n.slice(0);v.sort();v.reverse();for(var e=0;e<v.length;e++)f.splice(v[e],1);for(e=0;e<a.length;e++){var g=a[e];1==p.get_sensor_value(g,"COLLISION",0)&&(c=!0);g=h.get_object_bounding_box(g);b=b+f[e]+","+g.min_x.toFixed(3)+","+g.max_x.toFixed(3)+","+g.min_y.toFixed(3)+","+g.max_y.toFixed(3)+","+g.min_z.toFixed(3)+","+g.max_z.toFixed(3)+"$"}0==c?prompt("Here is your result! Please copy (CTRL+C) and paste into survey.",
b):window.alert("Please ensure there are no overlapping objects and try again.")});document.getElementById("delete").addEventListener("click",function(){if(f){var a=g.get_object_data_id(f);v.push(a-1);l.unload(a);f=null}});document.getElementById("rot-ccw").addEventListener("click",function(){f&&I(f,J)});document.getElementById("rot-cw").addEventListener("click",function(){f&&I(f,-J)})}function V(){for(var a=["delete","rot-ccw","rot-cw"],d=0;d<a.length;d++){var b=a[d];document.getElementById(b).addEventListener("mousedown",
function(a){a.target.parentNode.classList.add("active")});document.getElementById(b).addEventListener("mouseup",function(a){a.target.parentNode.classList.remove("active")});document.getElementById(b).addEventListener("touchstart",function(a){a.target.parentNode.classList.add("active")});document.getElementById(b).addEventListener("touchend",function(a){a.target.parentNode.classList.remove("active")})}}function r(a){var d=document.getElementById("spinner-container");a=g.get_all_objects("ALL",a);for(var b=
0;b<a.length;b++){var c=a[b];if(K.has_physics(c)){K.enable_simulation(c);var e=p.create_collision_sensor(c,"FURNITURE"),l=p.create_selection_sensor(c,!0);c==f&&p.set_custom_sensor(l,1);p.create_sensor_manifold(c,"COLLISION",p.CT_CONTINUOUS,[e,l],W,X);(e=k.get_parent(c))&&k.is_armature(e)?h.set_translation_v(e,B):h.set_translation_v(c,B)}k.is_mesh(c)&&(g.show_object(c),d.style.display="none")}}function W(a){return a[1]}function X(a,d,b){1==b&&(p.get_sensor_value(a,d,0)?g.set_outline_color(Y):g.set_outline_color(Z))}
function I(a,d){var b=k.get_parent(a);if(b&&k.is_armature(b)){var c=h.get_rotation(b,L);M.rotateZ(c,d,c);h.set_rotation_v(b,c)}else c=h.get_rotation(a,L),M.rotateZ(c,d,c),h.set_rotation_v(a,c);N(a)}function F(a){C=!0;a.preventDefault&&a.preventDefault();var d=x.get_coords_x(a);a=x.get_coords_y(a);var b=g.pick_object(d,a);f!=b&&(f&&g.clear_outline_anim(f),b&&g.apply_outline_anim(b,1,1,0),f=b);if(f){var b=g.get_active_camera(),c=k.get_parent(f);c&&k.is_armature(c)?h.get_translation(c,t):h.get_translation(f,
t);O.project_point(b,t,q);q[0]=d-q[0];q[1]=a-q[1]}}function G(){C=!1;y||(u.enable_camera_controls(),y=!0)}function H(a){if(C&&f){y&&(u.disable_camera_controls(),y=!1);var d=g.get_active_camera(),b=x.get_coords_x(a);a=x.get_coords_y(a);0<=b&&0<=a&&(b-=q[0],a-=q[1],b=O.calc_ray(d,b,a,z),b=w.get_pline_directional_vec(b,t),d=h.get_translation(d,aa),w.set_pline_initial_point(z,d),w.set_pline_directional_vec(z,b),(d=w.line_plane_intersect(ba,0,z,ca))&&0>b[2]&&((b=k.get_parent(f))&&k.is_armature(b)?h.set_translation_v(b,
d):h.set_translation_v(f,d),N(f)))}}function N(a){var d=h.get_object_bounding_box(a),b=k.get_parent(a),c=b&&k.is_armature(b)?h.get_translation(b,t):h.get_translation(a,t);4.572<d.max_x?c[0]-=d.max_x-4.572:0>d.min_x&&(c[0]+=0-d.min_x);5.182<d.max_y?c[1]-=d.max_y-5.182:0>d.min_y&&(c[1]+=0-d.min_y);b&&k.is_armature(b)?h.set_translation_v(b,c):h.set_translation_v(a,c)}var u=e("app"),O=e("camera"),da=e("config"),A=e("container"),p=e("controls"),l=e("data"),x=e("mouse"),w=e("math"),k=e("objects"),K=e("physics"),
E=e("preloader"),g=e("scenes"),h=e("transform"),P=e("version"),P=e("version"),M=e("quat"),D="DEBUG"===P.type(),Z=[0,1,0],Y=[1,0,0],ba=[0,0,1],J=Math.PI/2,m=da.get_std_assets_path("Living_Room"),q=new Float32Array(2),B=new Float32Array(3),t=new Float32Array(3),aa=new Float32Array(3),ca=new Float32Array(3),L=new Float32Array(4),z=w.create_pline(),C=!1,y=!0,n=[],v=[],f=null;Q.init=function(){var a=D,d=u.get_url_params();d&&"show_fps"in d&&(a=!0);u.init({canvas_container_id:"main_canvas_container",callback:R,
physics_enabled:!0,show_fps:a,alpha:!1,assets_dds_available:!D,assets_min50_available:!D,background_color:[1,1,1,0]})}});b4w.require("Living_Room").init();
